class PredictiveSearch{constructor(){this.container=document.querySelector(".thb-quick-search"),this.button=document.getElementById("quick-search"),this.close_button=this.container.querySelector(".thb-search-close"),this.input=this.container.querySelector('input[type="search"]'),this.predictiveSearchResults=this.container.querySelector(".thb-quick-search--results"),this.cache=new Map,this.cacheSize=20,this.setupEventListeners()}setupEventListeners(){this.container.querySelector("form.searchform").addEventListener("submit",this.onFormSubmit.bind(this)),this.input.addEventListener("input",debounce(e=>{this.onChange(e)},200).bind(this)),this.button.addEventListener("click",e=>{var t=this;return e.preventDefault(),document.querySelector(".header-section").classList.toggle("search-open"),document.querySelector(".header-section").classList.contains("search-open")&&(setTimeout(function(){t.input.focus({preventScroll:!0})},100),dispatchCustomEvent("search:open")),!1}),this.close_button.addEventListener("click",e=>{this.close(),e.preventDefault()}),document.addEventListener("keyup",e=>{"Escape"===e.key&&this.close()})}categoryToggle(){this.category_toggle=this.container.querySelectorAll(".search-categories a"),this.category_toggle.forEach(s=>{s.addEventListener("click",e=>{[].forEach.call(this.category_toggle,function(e){e.classList.remove("active")}),s.classList.add("active");var t=s.getAttribute("href");this.container.querySelectorAll(".search-results").forEach(e=>{e.classList.remove("active")}),this.container.querySelector(t).classList.add("active"),e.preventDefault()})})}getQuery(){return this.input.value.trim()}onChange(){var e=this.getQuery();e.length?this.getSearchResults(e):this.predictiveSearchResults.classList.remove("active")}onFormSubmit(e){this.getQuery().length||e.preventDefault()}onFocus(){var e=this.getQuery();e.length&&this.getSearchResults(e)}getSearchResults(e){let s=e.replace(" ","-").toLowerCase();this.cache.has(s)?this.renderSearchResults(this.cache.get(s)):(this.predictiveSearchResults.classList.add("loading"),fetch(`${theme.routes.predictive_search_url}?q=${encodeURIComponent(e)}&${encodeURIComponent("resources[type]")}=product,article,query&${encodeURIComponent("resources[limit]")}=10&section_id=predictive-search`).then(e=>{if(this.predictiveSearchResults.classList.remove("loading"),e.ok)return e.text();throw new Error(e.status)}).then(e=>{var t,e=(new DOMParser).parseFromString(e,"text/html").querySelector("#shopify-section-predictive-search").innerHTML;this.cache.set(s,e),this.cache.size>this.cacheSize&&(t=this.cache.keys().next().value,this.cache.delete(t)),this.renderSearchResults(e)}).catch(e=>{throw e}))}renderSearchResults(e){this.predictiveSearchResults.innerHTML=e,this.predictiveSearchResults.classList.add("active"),this.categoryToggle()}open(){document.querySelector(".header-section").classList.add("search-open")}close(){document.querySelector(".header-section").classList.remove("search-open")}}document.addEventListener("DOMContentLoaded",()=>{void 0!==PredictiveSearch&&new PredictiveSearch});